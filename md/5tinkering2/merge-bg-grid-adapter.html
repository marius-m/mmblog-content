<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2022-05-12 Thu 23:22 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BLOG: Merged grid</title>
<meta name="author" content="Marius Merkevičius" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
// @license magnet:?xt=urn:btih:e95b018ef3580986a04669f1b5879592219e2a7a&dn=public-domain.txt Public Domain
<!--/*--><![CDATA[/*><!--*/
     function CodeHighlightOn(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.add("code-highlighted");
         target.classList.add("code-highlighted");
       }
     }
     function CodeHighlightOff(elem, id)
     {
       var target = document.getElementById(id);
       if(null != target) {
         elem.classList.remove("code-highlighted");
         target.classList.remove("code-highlighted");
       }
     }
    /*]]>*///-->
// @license-end
</script>
</head>
<body>
<div id="content">
<h1 class="title">BLOG: Merged grid</h1>

<div id="outline-container-org72494e9" class="outline-2">
<h2 id="org72494e9">Merging adapter BGs</h2>
<div class="outline-text-2" id="text-org72494e9">
<p>
..or how to use &rsquo;Shapes&rsquo; in Android to use merged backgrounds in <code>RecyclerView.Adapter</code> when using <code>GridLayoutManager</code>. Good thing the title is not long enough 🤦
</p>

<p>
I don&rsquo;t see tutorials where you would get in trouble when displaying items in a list. But things get dicey when you start to apply a bit more complicated strategies for your use case.
</p>

<p>
For instance, have you tried using <code>ConcateAdapter</code> using adapters in a multiple spans <code>GridLayoutManager</code>? Or just simply using a regular <code>RecyclerView.Adapter</code> with <code>GridLayoutManager</code> to display items with separators instead of paddings?
</p>

<p>
For the last couple of weeks, I&rsquo;ve seen quite a bit of adapters. So I wanted to share some of the take-aways 🤷
</p>

<p>
Oh, and <a href="https://github.com/marius-m/merged-bg-grid-adapter">don&rsquo;t forget to check out Github repo for the sample app</a>!
</p>
</div>
</div>

<div id="outline-container-org6ded055" class="outline-2">
<h2 id="org6ded055">Double separator issue</h2>
<div class="outline-text-2" id="text-org6ded055">
<p>
To apply backgrounds to <code>RecyclerView.Adapter</code> items are <i>simple enough</i>. So, where is the problem?
</p>

<p>
Well, as always, <i>it depends</i>. If you have a list where items are separated, there is no problem.
</p>


<div id="org793e40f" class="figure">
<p><img src="imgs/76AF33C7-04FC-42B1-80E9-407E18E0EC2A.png" alt="76AF33C7-04FC-42B1-80E9-407E18E0EC2A.png" />
</p>
</div>

<p>
However, it starts to be an issue whenever the items become much closer. So close, as like having <span class="underline">no padding at all</span>. Then this happens 👇
</p>


<div id="org0816d81" class="figure">
<p><img src="imgs/422EDBB1-604B-4223-9514-055F39128275.png" alt="422EDBB1-604B-4223-9514-055F39128275.png" />
</p>
</div>

<p>
You get &rsquo;double lines&rsquo; as separators. And this was what I was actually aiming for 👇
</p>


<div id="org9b203e9" class="figure">
<p><img src="imgs/goal.png" alt="goal.png" />
</p>
</div>

<p>
How do we solve it? Well, a few solutions come to mind. We either have to <span class="underline">change backgrounds</span> or use <span class="underline">separators</span> that <code>RecyclerView</code> supports.
</p>
</div>
</div>

<div id="outline-container-orgba02cc3" class="outline-2">
<h2 id="orgba02cc3">Using separators (failed attempt)</h2>
<div class="outline-text-2" id="text-orgba02cc3">
<p>
I&rsquo;ll say from the get-go that this did not work out for me after a couple of tries. If you&rsquo;re here only for the solution, move a bit downward.
</p>
</div>

<div id="outline-container-orgb08630e" class="outline-3">
<h3 id="orgb08630e">Issue #1</h3>
<div class="outline-text-3" id="text-orgb08630e">
<p>
At #1, separators seem like a go-to solution. Even the name tells us as much 🤷.
</p>

<p>
It may seem to fix our problem, right? Well, <b>no</b>. This does not work when trying to use it in <code>RecyclerView</code> + <code>GridLayoutManager</code>.
</p>

<p>
The first problem is that &rsquo;separators&rsquo; are applied to the whole <code>RecyclerView</code>. So if you have <code>GridLayoutManager</code> with a grid span of 2+, it would <span class="underline">use a separator for the entire section</span>.
</p>
</div>
</div>

<div id="outline-container-orgf68bf09" class="outline-3">
<h3 id="orgf68bf09">Issue #2</h3>
<div class="outline-text-3" id="text-orgf68bf09">
<p>
Problem #2, when you apply separators, <span class="underline">it applies only in the direction you are separating the items</span>. If you try to modify the <code>RecyclerView</code> with <code>MaterialDividerItemDecoration</code>, it has no problem when scrolling in provided direction. However, it does if you would try to draw &rsquo;separators&rsquo; in the direction where the items do not scroll.
</p>
</div>
</div>

<div id="outline-container-org39fa2f9" class="outline-3">
<h3 id="org39fa2f9">Issue #13489579817235</h3>
<div class="outline-text-3" id="text-org39fa2f9">
<p>
The last nail in the coffin ⚰️ was when or if you&rsquo;re using <code>ConcatAdapter</code>. I won&rsquo;t go into too much detail, but this majorly breaks most of what you wanted to achieve.
</p>

<p>
Even though I could not use separators on my use case, but I can&rsquo;t deny that <span class="underline">it was a good learning experience</span>. <a href="https://gist.github.com/marius-m/c8e39761bf054d645b548cd4f63a13c4">You can even try out using my updated separator if you wish so, as a starting point if you&rsquo;re adventurous enough</a>. It is heavily &rsquo;inspired&rsquo; by <code>MaterialDividerItemDecoration</code>.
</p>
</div>
</div>
</div>

<div id="outline-container-org963a871" class="outline-2">
<h2 id="org963a871">Using different backgrounds (success 🙌)</h2>
<div class="outline-text-2" id="text-org963a871">
<p>
In some sense, this seems a bit counterintuitive and a more complicated solution than it should be. And I still think <i>this is the case</i>. However, I did manage to get a working solution and I&rsquo;m pretty happy about it. At least for now.
</p>
</div>

<div id="outline-container-org1318490" class="outline-3">
<h3 id="org1318490">The trick</h3>
<div class="outline-text-3" id="text-org1318490">
<p>
The whole idea is simple.
</p>
<ul class="org-ul">
<li>We provide a different background to a cell, depending on where the cell is.</li>
<li>Provide a background line where only it is needed</li>
</ul>

<p>
It is a bit difficult to explain in words, so I&rsquo;ll try to call my drawing superpowers 🦸.
</p>
</div>
</div>

<div id="outline-container-orgee52c9b" class="outline-3">
<h3 id="orgee52c9b">Drawing Android shapes</h3>
<div class="outline-text-3" id="text-orgee52c9b">
<p>
Oh, and I almost forgot. <b>This is how you provide a background using Android shapes</b>. If you want to control how you draw different backgrounds with provided borders, you&rsquo;ll need this.
</p>

<ul class="org-ul">
<li><p>
Declare an xml with a <code>shape</code> in <code>{project}/app/src/main/res/drawable/shape.xml</code>
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;?<span style="color: #85dacc; font-style: italic;">xml</span> <span style="color: #958e8f; font-style: italic;">version="1.0" encoding="utf-8"</span>?&gt;
  &lt;?<span style="color: #85dacc; font-style: italic;">xml</span> <span style="color: #958e8f; font-style: italic;">version="1.0" encoding="utf-8"</span>?&gt;
  &lt;<span style="color: #adda78;">layer-list</span> <span style="color: #a8a9eb;">xmlns</span>:<span style="color: #fff1f3;">android</span>=<span style="color: #f9cc6c;">"http://schemas.android.com/apk/res/android"</span>&gt;
      &lt;<span style="color: #adda78;">item</span>&gt;
          &lt;<span style="color: #adda78;">shape</span>&gt;
              &lt;<span style="color: #adda78;">padding</span> <span style="color: #a8a9eb;">android</span>:<span style="color: #fff1f3;">left</span>=<span style="color: #f9cc6c;">"1dp"</span> <span style="color: #a8a9eb;">android</span>:<span style="color: #fff1f3;">top</span>=<span style="color: #f9cc6c;">"1dp"</span> <span style="color: #a8a9eb;">android</span>:<span style="color: #fff1f3;">right</span>=<span style="color: #f9cc6c;">"1dp"</span> <span style="color: #a8a9eb;">android</span>:<span style="color: #fff1f3;">bottom</span>=<span style="color: #f9cc6c;">"1dp"</span>/&gt;
              &lt;<span style="color: #adda78;">solid</span> <span style="color: #a8a9eb;">android</span>:<span style="color: #fff1f3;">color</span>=<span style="color: #f9cc6c;">"@color/cardStroke"</span> /&gt;
          &lt;/<span style="color: #adda78;">shape</span>&gt;
      &lt;/<span style="color: #adda78;">item</span>&gt;
      &lt;<span style="color: #adda78;">item</span>&gt;
          &lt;<span style="color: #adda78;">shape</span>&gt;
              &lt;<span style="color: #adda78;">solid</span> <span style="color: #a8a9eb;">android</span>:<span style="color: #fff1f3;">color</span>=<span style="color: #f9cc6c;">"@color/cardBackground"</span> /&gt;
          &lt;/<span style="color: #adda78;">shape</span>&gt;
      &lt;/<span style="color: #adda78;">item</span>&gt;
  &lt;/<span style="color: #adda78;">layer-list</span>&gt;
</pre>
</div></li>
<li><p>
And use that background on any container (<code>ViewGroup</code>)
</p>
<div class="org-src-container">
<pre class="src src-xml">&lt;?<span style="color: #85dacc; font-style: italic;">xml</span> <span style="color: #958e8f; font-style: italic;">version="1.0" encoding="utf-8"</span>?&gt;
&lt;?<span style="color: #85dacc; font-style: italic;">xml</span> <span style="color: #958e8f; font-style: italic;">version="1.0" encoding="utf-8"</span>?&gt;
&lt;<span style="color: #adda78;">FrameLayout</span> <span style="color: #a8a9eb;">xmlns</span>:<span style="color: #fff1f3;">android</span>=<span style="color: #f9cc6c;">"http://schemas.android.com/apk/res/android"</span>
    <span style="color: #a8a9eb;">xmlns</span>:<span style="color: #fff1f3;">app</span>=<span style="color: #f9cc6c;">"http://schemas.android.com/apk/res-auto"</span>
    <span style="color: #a8a9eb;">xmlns</span>:<span style="color: #fff1f3;">tools</span>=<span style="color: #f9cc6c;">"http://schemas.android.com/tools"</span>
    <span style="color: #a8a9eb;">android</span>:<span style="color: #fff1f3;">layout_width</span>=<span style="color: #f9cc6c;">"match_parent"</span>
    <span style="color: #a8a9eb;">android</span>:<span style="color: #fff1f3;">layout_height</span>=<span style="color: #f9cc6c;">"wrap_content"</span>
    <span style="color: #a8a9eb;">android</span>:<span style="color: #fff1f3;">background</span>=<span style="color: #f9cc6c;">"@drawable/shape_ll_basic"</span>&gt;

    <span style="color: #72696a; font-style: italic;">&lt;!-- </span><span style="color: #72696a; font-style: italic;">&#9757;&#65039; Declared background</span><span style="color: #72696a; font-style: italic;">--&gt;</span>

    &lt;... xml content ... /&gt;

&lt;/<span style="color: #adda78;">FrameLayout</span>&gt;
</pre>
</div></li>
</ul>
</div>
</div>

<div id="outline-container-org39eaa24" class="outline-3">
<h3 id="org39eaa24">Moving to the 1st item</h3>
<div class="outline-text-3" id="text-org39eaa24">
<p>
It&rsquo;s important to know <span class="underline">where is the first row</span> and <span class="underline">where is the first item in the column</span>. For the first item, we provide a background, that has all the corners drawn. Like so.
</p>


<div id="orga293e8a" class="figure">
<p><img src="imgs/0_0.png" alt="0_0.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-org8c7d5e2" class="outline-3">
<h3 id="org8c7d5e2">Moving to the right 👉</h3>
<div class="outline-text-3" id="text-org8c7d5e2">
<p>
Next, we should define the background for the item next to it. But, because <span class="underline">we already have a left bar in the background, we should append only top, bottom, and right bars</span>. Like so 👇
</p>


<div id="org9bd9851" class="figure">
<p><img src="imgs/0_1.png" alt="0_1.png" />
</p>
</div>


<p>
You&rsquo;re probably starting to <i>catch the drift</i> of how we&rsquo;re composing these backgrounds by <span class="underline">only appending bars only where it is needed</span>.
</p>

<p>
The coolest part about it, if we had more items to the right, we would only need to apply the same background - <span class="underline">top, bottom, and right bars</span>. Like so
</p>


<div id="org329a2ab" class="figure">
<p><img src="imgs/0_merge.png" alt="0_merge.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgd60d918" class="outline-3">
<h3 id="orgd60d918">Moving downward👇</h3>
<div class="outline-text-3" id="text-orgd60d918">
<p>
Alright. Now that we know how to display the whole row, we need to move downwards.
</p>

<p>
Once again, the most important thing is to know <span class="underline">which item is first</span>. As we know, this is not the first row, and we already have a top bar. So, what we need are <span class="underline">left, right, and bottom bars</span>.
</p>


<div id="org32fbb3d" class="figure">
<p><img src="imgs/1_0.png" alt="1_0.png" />
</p>
</div>

<p>
And the rest of the items on the right would require only <span class="underline">left and bottom, as we already have top and left bars</span>.
</p>


<div id="org28816e3" class="figure">
<p><img src="imgs/1_1.png" alt="1_1.png" />
</p>
</div>

<p>
And this works really well for the rest of the items as well if we would provide more items in the grid 👇
</p>


<div id="orgdfea308" class="figure">
<p><img src="imgs/1_merge.png" alt="1_merge.png" />
</p>
</div>
</div>
</div>

<div id="outline-container-orgdd97cbf" class="outline-3">
<h3 id="orgdd97cbf">The code</h3>
<div class="outline-text-3" id="text-orgdd97cbf">
<p>
Now that we know the basic premise of what we&rsquo;re aiming for let us see how we implement the <code>RecyclerView.Adapter</code>. The coolest part is that there is not much logic here. As stated before, we only need to figure out
</p>

<ul class="org-ul">
<li><p>
Is the item in the first row
</p>
<div class="org-src-container">
<pre class="src src-kotlin"><span style="color: #85dacc; font-style: italic;">private</span> <span style="color: #85dacc; font-style: italic;">fun</span> <span style="color: #adda78;">isItemInFirstRow</span>(pos: <span style="color: #85dacc;">Int</span>): <span style="color: #85dacc;">Boolean</span> {
    <span style="color: #85dacc; font-style: italic;">return</span> pos &lt;= gridSpanSize - <span style="color: #a8a9eb; font-weight: bold;">1</span>
}
</pre>
</div></li>
<li><p>
Is the item first in column
</p>
<div class="org-src-container">
<pre class="src src-kotlin"><span style="color: #85dacc; font-style: italic;">private</span> <span style="color: #85dacc; font-style: italic;">fun</span> <span style="color: #adda78;">isItemInFirstColumn</span>(pos: <span style="color: #85dacc;">Int</span>): <span style="color: #85dacc;">Boolean</span> {
    <span style="color: #85dacc; font-style: italic;">return</span> pos % gridSpanSize == <span style="color: #a8a9eb; font-weight: bold;">0</span>
}
</pre>
</div></li>
</ul>

<p>
The rest of the adapter looks nothing out of ordinary.
</p>

<div class="org-src-container">
<pre class="src src-kotlin"><span style="color: #85dacc; font-style: italic;">class</span> <span style="color: #85dacc;">MergeAdapter&lt;T</span> : <span style="color: #85dacc;">BasicAdapterItem&gt;</span>(
    <span style="color: #85dacc; font-style: italic;">private</span> <span style="color: #85dacc; font-style: italic;">val</span> <span style="color: #fff1f3;">gridSpanSize</span>: <span style="color: #85dacc;">Int</span>,
    <span style="color: #85dacc; font-style: italic;">private</span> <span style="color: #85dacc; font-style: italic;">val</span> <span style="color: #fff1f3;">itemClickListener</span>: ((<span style="color: #85dacc;">BasicAdapterItem</span>) -&gt; <span style="color: #85dacc;">Unit</span>)? = <span style="color: #a8a9eb;">null</span>,
) : <span style="color: #85dacc;">RecyclerView.Adapter&lt;MergeAdapterViewHolder&lt;T&gt;&gt;</span>(), <span style="color: #85dacc;">ItemBoundableAdapter&lt;T&gt;</span> {

    <span style="color: #85dacc; font-style: italic;">override</span> <span style="color: #85dacc; font-style: italic;">var</span> <span style="color: #fff1f3;">items</span>: <span style="color: #85dacc;">List&lt;T&gt;</span> <span style="color: #85dacc; font-style: italic;">by</span> <span style="color: #85dacc;">Delegates.observable</span>(emptyList()) { _, oldList, newList -&gt;
        autoNotify(oldList, newList) { o, n -&gt; o.id == n.id }
    }

    <span style="color: #85dacc; font-style: italic;">override</span> <span style="color: #85dacc; font-style: italic;">fun</span> <span style="color: #adda78;">onCreateViewHolder</span>(
        viewGroup: <span style="color: #85dacc;">ViewGroup</span>,
        viewType: <span style="color: #85dacc;">Int</span>
    ): <span style="color: #85dacc;">MergeAdapterViewHolder&lt;T&gt;</span> {
        <span style="color: #85dacc; font-style: italic;">return</span> <span style="color: #85dacc;">MergeAdapterViewHolder.create</span>(viewGroup)
    }

    <span style="color: #85dacc; font-style: italic;">override</span> <span style="color: #85dacc; font-style: italic;">fun</span> <span style="color: #adda78;">onBindViewHolder</span>(
        holder: <span style="color: #85dacc;">MergeAdapterViewHolder&lt;T&gt;</span>,
        position: <span style="color: #85dacc;">Int</span>,
    ) {
        <span style="color: #85dacc; font-style: italic;">val</span> <span style="color: #fff1f3;">isItemInFirstRow</span> = isItemInFirstRow(position)
        <span style="color: #85dacc; font-style: italic;">val</span> <span style="color: #fff1f3;">isItemInFirstColumn</span> = isItemInFirstColumn(position)
        <span style="color: #85dacc; font-style: italic;">val</span> <span style="color: #fff1f3;">item</span> = items[position]
        holder.bind(
            isItemInFirstRow,
            isItemInFirstColumn,
            item,
            itemClickListener
        )
    }

    <span style="color: #72696a; font-style: italic;">/**</span>
<span style="color: #72696a; font-style: italic;">     * @return item position is in the first row</span>
<span style="color: #72696a; font-style: italic;">     */</span>
    <span style="color: #85dacc; font-style: italic;">private</span> <span style="color: #85dacc; font-style: italic;">fun</span> <span style="color: #adda78;">isItemInFirstRow</span>(pos: <span style="color: #85dacc;">Int</span>): <span style="color: #85dacc;">Boolean</span> {
        <span style="color: #85dacc; font-style: italic;">return</span> pos &lt;= gridSpanSize - <span style="color: #a8a9eb; font-weight: bold;">1</span>
    }

    <span style="color: #72696a; font-style: italic;">/**</span>
<span style="color: #72696a; font-style: italic;">     * @return item position is in the first column, when on different rows</span>
<span style="color: #72696a; font-style: italic;">     */</span>
    <span style="color: #85dacc; font-style: italic;">private</span> <span style="color: #85dacc; font-style: italic;">fun</span> <span style="color: #adda78;">isItemInFirstColumn</span>(pos: <span style="color: #85dacc;">Int</span>): <span style="color: #85dacc;">Boolean</span> {
        <span style="color: #85dacc; font-style: italic;">return</span> pos % gridSpanSize == <span style="color: #a8a9eb; font-weight: bold;">0</span>
    }

    <span style="color: #85dacc; font-style: italic;">override</span> <span style="color: #85dacc; font-style: italic;">fun</span> <span style="color: #adda78;">getItemCount</span>(): <span style="color: #85dacc;">Int</span> = items.size
}
</pre>
</div>


<p>
Now we provide the resolved properties to the <code>ViewHolder</code> to draw items.
</p>

<ul class="org-ul">
<li><p>
Snippet to apply the background
</p>
<div class="org-src-container">
<pre class="src src-kotlin"> <span style="color: #72696a; font-style: italic;">/**</span>
<span style="color: #72696a; font-style: italic;"> * Provides diff background based on item position in the grid</span>
<span style="color: #72696a; font-style: italic;"> * @param isFirstRow item is in the first row of the grid</span>
<span style="color: #72696a; font-style: italic;"> * @param isFirstColumn item is in the first column of the row</span>
<span style="color: #72696a; font-style: italic;"> */</span>
@<span style="color: #85dacc;">DrawableRes</span>
<span style="color: #85dacc; font-style: italic;">private</span> <span style="color: #85dacc; font-style: italic;">fun</span> <span style="color: #adda78;">bgResourceByPosition</span>(
    isFirstRow: <span style="color: #85dacc;">Boolean</span>,
    isFirstColumn: <span style="color: #85dacc;">Boolean</span>,
): <span style="color: #85dacc;">Int</span> {
    <span style="color: #85dacc; font-style: italic;">return</span> <span style="color: #85dacc; font-style: italic;">when</span> {
        isFirstRow &amp;&amp; isFirstColumn -&gt; <span style="color: #85dacc;">R.drawable.shape_ll_merge_row_column_first</span>
        isFirstRow &amp;&amp; !isFirstColumn -&gt; <span style="color: #85dacc;">R.drawable.shape_ll_merge_row_column_last</span>
        isFirstColumn -&gt; <span style="color: #85dacc;">R.drawable.shape_ll_merge_column_first</span>
        <span style="color: #85dacc; font-style: italic;">else</span> -&gt; <span style="color: #85dacc;">R.drawable.shape_ll_merge_column_last</span>
    }
}
</pre>
</div></li>
<li><p>
Rest of the <code>ViewHolder</code> is nothing out of ordinary
</p>
<div class="org-src-container">
<pre class="src src-kotlin"><span style="color: #85dacc; font-style: italic;">class</span> <span style="color: #85dacc;">MergeAdapterViewHolder&lt;T</span> : <span style="color: #85dacc;">BasicAdapterItem&gt;</span>(
    <span style="color: #85dacc; font-style: italic;">private</span> <span style="color: #85dacc; font-style: italic;">val</span> <span style="color: #fff1f3;">binding</span>: <span style="color: #85dacc;">ItemMergedBinding</span>,
) : <span style="color: #85dacc;">RecyclerView.ViewHolder</span>(binding.root) {

    <span style="color: #85dacc; font-style: italic;">fun</span> <span style="color: #adda78;">bind</span>(
        isFirstRow: <span style="color: #85dacc;">Boolean</span>,
        isFirstColumn: <span style="color: #85dacc;">Boolean</span>,
        item: <span style="color: #85dacc;">T</span>,
        itemClickListener: ((<span style="color: #85dacc;">T</span>) -&gt; <span style="color: #85dacc;">Unit</span>)?
    ) {
        <span style="color: #85dacc; font-style: italic;">val</span> <span style="color: #fff1f3;">viewClickListener</span> = toViewClickListenerOrNull(item, itemClickListener)
        binding.root.setOnClickListener(viewClickListener)
        binding.title.text = item.title
        binding.root.setBackgroundResource(bgResourceByPosition(isFirstRow, isFirstColumn))
    }

    <span style="color: #72696a; font-style: italic;">/**</span>
<span style="color: #72696a; font-style: italic;">     * Provides diff background based on item position in the grid</span>
<span style="color: #72696a; font-style: italic;">     * @param isFirstRow item is in the first row of the grid</span>
<span style="color: #72696a; font-style: italic;">     * @param isFirstColumn item is in the first column of the row</span>
<span style="color: #72696a; font-style: italic;">     */</span>
    @<span style="color: #85dacc;">DrawableRes</span>
    <span style="color: #85dacc; font-style: italic;">private</span> <span style="color: #85dacc; font-style: italic;">fun</span> <span style="color: #adda78;">bgResourceByPosition</span>(
        isFirstRow: <span style="color: #85dacc;">Boolean</span>,
        isFirstColumn: <span style="color: #85dacc;">Boolean</span>,
    ): <span style="color: #85dacc;">Int</span> {
        <span style="color: #85dacc; font-style: italic;">return</span> <span style="color: #85dacc; font-style: italic;">when</span> {
            isFirstRow &amp;&amp; isFirstColumn -&gt; <span style="color: #85dacc;">R.drawable.shape_ll_merge_row_column_first</span>
            isFirstRow &amp;&amp; !isFirstColumn -&gt; <span style="color: #85dacc;">R.drawable.shape_ll_merge_row_column_last</span>
            isFirstColumn -&gt; <span style="color: #85dacc;">R.drawable.shape_ll_merge_column_first</span>
            <span style="color: #85dacc; font-style: italic;">else</span> -&gt; <span style="color: #85dacc;">R.drawable.shape_ll_merge_column_last</span>
        }
    }

    <span style="color: #85dacc; font-style: italic;">companion</span> <span style="color: #85dacc; font-style: italic;">object</span> {
        <span style="color: #85dacc; font-style: italic;">fun</span> &lt;<span style="color: #85dacc;">T</span> : <span style="color: #85dacc;">BasicAdapterItem&gt;</span> create(viewGroup: <span style="color: #85dacc;">ViewGroup</span>): <span style="color: #85dacc;">MergeAdapterViewHolder&lt;T&gt;</span> {
            <span style="color: #85dacc; font-style: italic;">return</span> <span style="color: #85dacc;">MergeAdapterViewHolder</span>(
                binding = <span style="color: #85dacc;">ItemMergedBinding.inflate</span>(
                    <span style="color: #85dacc;">LayoutInflater.from</span>(viewGroup.context),
                    viewGroup,
                    <span style="color: #a8a9eb;">false</span>
                )
            )
        }
    }
}
</pre>
</div></li>
</ul>

<p>
As always, if the code snippets are not enough, <a href="https://github.com/marius-m/merged-bg-grid-adapter">check out the sample app on Github and try it yourself</a>! It has basic adapters, adapters with paddings, and merged background adapters (what we were trying to do here) to try out 💪.
</p>
</div>
</div>
</div>

<div id="outline-container-orgade0ac2" class="outline-2">
<h2 id="orgade0ac2">Ending notes</h2>
<div class="outline-text-2" id="text-orgade0ac2">
<p>
Now. This is not exactly <i>rocket science</i> for sure. However, I did not think twice when picking up the task. By starting to dig deeper, I have realized how many parts I need to figure out first for the designs to be accurate.
</p>

<p>
Hopefully, this will be useful for you as well, and you won&rsquo;t need to spend so much time as I did 🤷🚀.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Marius Merkevičius</p>
<p class="date">Created: 2022-05-12 Thu 23:22</p>
</div>
</body>
</html>
